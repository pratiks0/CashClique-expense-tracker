{% extends "base.html" %}
{% block content %}
<div class="dashboard-container">
  <div class="dashboard-box">
    <h2 class="dashboard-title">Dashboard</h2>
    
    <!-- Totals Section -->
    <div class="card-container">
      <div class="dashboard-card">
        <div class="card-header">Total Income</div>
        <div class="card-body">
          <h5 class="card-value">₹{{ total_income }}</h5>
        </div>
      </div>
      <div class="dashboard-card">
        <div class="card-header">Total Expenses</div>
        <div class="card-body">
          <h5 class="card-value">₹{{ total_expense }}</h5>
        </div>
      </div>
      <div class="dashboard-card">
        <div class="card-header">Balance</div>
        <div class="card-body">
          <h5 class="card-value">₹{{ balance }}</h5>
        </div>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="action-buttons text-center mb-3">
      <a href="{{ url_for('add_income') }}" class="btn btn-success me-2">Add Income</a>
      <a href="{{ url_for('add_expense') }}" class="btn btn-primary me-2">Add Expense</a>
    </div>
    
    <!-- Reset Button -->
    <div class="reset-container text-center mb-3">
      <form action="{{ url_for('reset') }}" method="POST">
        <button type="submit" class="btn btn-reset">Reset All Income and Expenses</button>
      </form>
    </div>
    
    <!-- Chart Section -->
    <div class="chart-container">
      <canvas id="expenseChart"></canvas>
    </div>
    
    <!-- Expenses Table -->
    <div class="expenses-container">
      <h3>Expenses</h3>
      <div class="table-responsive">
        <table class="table expenses-table">
          <thead>
            <tr>
              <th>Description</th>
              <th>Category</th>
              <th>Amount</th>
              <th>Date</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for expense in expenses %}
            <tr>
              <td>{{ expense.raw_text }}</td>
              <td>{{ expense.category }}</td>
              <td>₹{{ expense.amount }}</td>
              <td>{{ expense.timestamp.strftime('%Y-%m-%d') }}</td>
              <td>
                <form action="{{ url_for('delete_expense', expense_id=expense.id) }}" method="POST" style="display:inline;">
                  <button type="submit" class="btn btn-delete">Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    
  </div>
</div>

<style>
  /* Background */
  body {
    background: #0d0d10;
    color: #e0e0e0;
    font-family: 'Inter', sans-serif;
  }

  .dashboard-container {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 3rem 1rem;
    position: relative;
    overflow: hidden;
  }

  /* Dashboard Box */
  .dashboard-box {
    background: rgba(26, 26, 31, 0.85);
    border-radius: 20px;
    padding: 2rem;
    width: 100%;
    max-width: 1000px;
    backdrop-filter: blur(20px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.08);
    animation: fadeIn 0.6s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .dashboard-title {
    text-align: center;
    font-size: 2rem;
    font-weight: 700;
    color: #fff;
    margin-bottom: 2rem;
  }

  /* Cards */
  .card-container {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .dashboard-card {
    flex: 1;
    min-width: 250px;
    background: rgba(40, 40, 50, 0.7);
    border-radius: 16px;
    padding: 1.5rem;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 20px rgba(130, 87, 229, 0.5);
  }

  .card-header {
    font-size: 1rem;
    font-weight: 500;
    color: #aaa;
    margin-bottom: 0.5rem;
  }

  .card-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: #fff;
  }

  /* Buttons */
  .action-buttons a,
  .btn-reset {
    display: inline-block;
    min-width: 160px;
    padding: 0.8rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    text-align: center;
    text-decoration: none;
    color: #fff;
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 0.5rem;
  }

  .btn-success {
    background: linear-gradient(135deg, #22c55e, #16a34a);
  }

  .btn-success:hover {
    box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
  }

  .btn-primary {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
  }

  .btn-primary:hover {
    box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
  }

  .btn-reset {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border: none;
  }

  .btn-reset:hover {
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
  }

  .btn-delete {
    background: linear-gradient(135deg, #ef4444, #b91c1c);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 500;
    color: #fff;
    transition: all 0.3s ease;
  }

  .btn-delete:hover {
    box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
  }

  /* Chart */
  .chart-container {
    margin: 2rem auto;
    max-width: 850px;
    background: rgba(40, 40, 50, 0.7);
    border-radius: 16px;
    padding: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* Table */
.expenses-container {
  margin-top: 2rem;
}

.expenses-container h3 {
  font-size: 1.5rem;
  color: #fff;
  text-align: center;
  margin-bottom: 1rem;
}

.expenses-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
  background: rgba(88, 83, 83, 0.85); /* darker base */
  border-radius: 12px;
  overflow: hidden;
}

.expenses-table th,
.expenses-table td {
  padding: 0.9rem;
  text-align: center;
  color: #000000; /* light gray text */
}

.expenses-table th {
  background: rgba(255, 255, 255, 0.05);
  color: #bbb;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.expenses-table tr {
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.expenses-table tr:last-child {
  border-bottom: none;
}

.expenses-table tr:hover {
  background: rgba(130, 87, 229, 0.15); /* purple highlight on hover */
}


  /* Responsive */
  @media (max-width: 576px) {
    .card-container {
      flex-direction: column;
    }
    .action-buttons a, .reset-container button {
      width: 100%;
      margin-bottom: 1rem;
    }
  }
</style>
{% endblock %}

{% block scripts %}
<!-- Load Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  var labels = JSON.parse('{{ category_totals.keys() | list | tojson | safe }}');
  var datasetData = JSON.parse('{{ category_totals.values() | list | tojson | safe }}');

  var colors = [
      'rgba(130, 87, 229, 0.8)',
      'rgba(59, 130, 246, 0.8)',
      'rgba(16, 185, 129, 0.8)',
      'rgba(251, 191, 36, 0.8)',
      'rgba(244, 63, 94, 0.8)',
      'rgba(236, 72, 153, 0.8)'
  ];

  var data = {
    labels: labels,
    datasets: [{
      label: 'Expense Amount',
      data: datasetData,
      backgroundColor: colors,
      borderColor: colors.map(c => c.replace('0.8','1')),
      borderWidth: 1,
      borderRadius: 6
    }]
  };

  var ctx = document.getElementById('expenseChart').getContext('2d');
  var expenseChart = new Chart(ctx, {
    type: 'bar',
    data: data,
    options: {
      plugins: {
        legend: { labels: { color: "#ccc" } }
      },
      scales: {
        x: { ticks: { color: "#aaa" }, grid: { color: "rgba(255,255,255,0.05)" } },
        y: { ticks: { color: "#aaa" }, grid: { color: "rgba(255,255,255,0.05)" }, beginAtZero: true }
      }
    }
  });
</script>
{% endblock %}
